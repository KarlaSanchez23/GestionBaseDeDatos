--Trigger que no permita agregar nuevos beneficiarios cuando supera la base estipulada.
--crear función
CREATE OR REPLACE FUNCTION  nuevo_benef() RETURNS TRIGGER AS
$nuevo_benef$ 
  DECLARE
    tipomaximo int;
    limite int;
BEGIN
   select count(*) into tipomaximo from CLIENTE where idcliente=new.idcliente;
   select cantidad_benef into limite from BENEFICIARIO;
   if ( tipomaximo >= limite ) then
   RAISE EXCEPTION 'No se puede agregar más beneficiarios, superó el límite';
   END if;
   RETURN new;
END;
$nuevo_benef$
LANGUAGE plpgsql;

--crear trigger
create trigger nuevo_benef before insert
on BENEFICIARIO fOR EACH ROW
execute procedure nuevo_benef();

--INSERTAR NUEVO BENEFICIARIO
insert into BENEFICIARIO values ('10','2','2','Martin','Valdez','Hijo','2','03/12/1999');


