--CREAR UN CURSOR QUE MUESTRE LOS TIPOS DE SEGUROS, SU CANTIDAD DE BENEFICIARIO Y LA SUMA TOTAL DE LOS SEGUROS DADOS

--DECLARAR VARIABLES
declare @nombre_seguro varchar (30), 
		@beneficiario int, 
		@total int

--CREAR EL CURSOR
declare c_recorrer cursor
	for 
		SELECT TIPO_NOMBRE, COUNT(NOMBRE) AS NUMERO_BENEFICIARIO, 
				SUM(CANTIDAD_PAGO) AS CANTIDAD_TOTAL 
		FROM TIPO_SEGURO, BENEFICIARIO, PAGO
		WHERE BENEFICIARIO.IDBENEFICIARIO=TIPO_SEGURO.IDTIPOSEGURO AND 
			  BENEFICIARIO.IDBENEFICIARIO=PAGO.IDPAGO
		GROUP  BY TIPO_NOMBRE

--ABRIR EL CURSOR
OPEN c_recorrer

--CAPTURA Y RECORRE LOS DATOS DEL CURSOR
FETCH NEXT FROM c_recorrer into @nombre_seguro, @beneficiario, @total

WHILE @@FETCH_STATUS=0
BEGIN
	
--PROCESA EL SIGUIENTE REGISTRO DEL CURSOR
INSERT INTO CONSULTA VALUES ( @nombre_seguro, @beneficiario, @total);
FETCH NEXT FROM c_recorrer INTO  @nombre_seguro, @beneficiario, @total
END

--CERRAR EL CURSOR Y LIBERAR EL CURSOR
CLOSE c_recorrer
DEALLOCATE c_recorrer


SELECT * FROM CONSULTA
